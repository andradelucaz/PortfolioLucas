---
title: "Análise da Base RAIS"
description: |
  Essa é uma análise de salários da base RAIS, feita na Semana Data Science na Prática da Curso-R.[EM CONSTRUÇÃO...]
author:
  - name: Lucas Andrade
    url: https://www.linkedin.com/in/lucas-silva-andrade-155a27165/
date: 2021-12-09
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Esse é o meu primeiro projeto no portfólio. O o objetivo desse relatório é responder à seguinte pergunta: Quanto ganha um Cientista de Dados? Para isso vamos utilizar a base da RAIS anonimizada

#Acessando os dados da RAIS

Vamos utilizar o datalake da incrível iniciativa Base dos Dados (<https://basedosdados.org/>)

```{r message=FALSE, warning=FALSE}
library(bigrquery)
library(dplyr)
library(tidyverse)
```

Abaixo está o código que carrega as primeiras 5 linhas que carrega a tabela de microdados

```{r eval=FALSE, include=FALSE}
conexao <- dbConnect(
  bigquery(),
  project = 'basedosdados',
  dataset = 'br_me_rais',
  billing = 'analise-rais-portfolio'
)
```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

bd_cinco <- tbl(conexao, "microdados_vinculos") %>%
  select (everything()) %>%
  head(5) %>%
  collect()
 
bd_cinco 

```

Para analisar apenas os dados dos vínculos formais relacionados à ciência de dados precisaremos filtrar a base. utilizaremos como filtro os códigos dos vínculos declarados que se relacionam à ciência de dados e são cadastrados no Código Brasileiro de Ocupação. A base RAIS será então filtrada tomando como critérios códigos das profissõesoes atreladas à ciência de dados. NEsse primeiro momento selecionei apenas as 5000 primeira linhas

```{r eval=FALSE, include=FALSE}
codigos_cbo <- c ('252515', "252525", "211110", 
                  #pesquisa científica
                  '211205', '211210', '411035',
                  '131120', '211215' 
                  #ocupações estatísticas
)

micrdodados_vinculos_tbl <- tbl(conexao, "microdados_vinculos") %>% 
  select (everything()) %>% 
  filter(
    ano >= 2013,
    cbo_2002 %in% codigos_cbo
    ) %>% 
  head(5000)


tabela_micrdodados_vinculos <- collect(micrdodados_vinculos_tbl)
```

Agora vamos rodar a base completa!

```{r eval=FALSE, include=FALSE}

tabela_micrdodados_vinculos_tbl <- tbl(conexao, "microdados_vinculos") %>% 
  select (everything()) %>% 
  filter(
    ano >= 2013,
    cbo_2002 %in% codigos_cbo
    )

tabela_micrdodados_vinculos_tbl
tabela_microdados_vinculos <- collect(tabela_micrdodados_vinculos_tbl)

saveRDS(tabela_microdados_vinculos, "tabela_microdados_vinculos.rds" )
```

Os dados já carregados servirão para responder à pergunta principal que move essa análise: **"Quanto ganha em média, uma pessoa que trabalha com ciência de dados?**

Segundo os dados registrados na base RAIS, uma pessoa que trabalha com ciência de dados recebe em média:

```{r, echo=FALSE}

tabela_microdados_vinculos <- readRDS("tabela_microdados_vinculos.rds")

sal_media <- round(mean(tabela_microdados_vinculos$valor_remuneracao_media), 2)
```

```{r}
sal_media
```

Além dessa pergunta principal, podemos ainda nos aprofundarmos na análise e responder ao seguintes questionamentos:

-   Quanto o valor médio do salário varia em relação ao ano anterior?

    ```{r}
    media_ano <- tabela_microdados_vinculos %>% 
  group_by(ano) %>% 
  summarise(media_salarial = round(mean(valor_remuneracao_media),2))
    
    knitr::kable(media_ano)
    ```


    ```{r}
    ggplot(media_ano) +
    geom_col(aes(x = ano, y = media_salarial, fill = ano), show.legend = FALSE) +
    geom_text(aes(x = ano, y = media_salarial*0.85, label = media_salarial, fontface = 'bold')) +
    scale_x_continuous(breaks = c(2013:2019))
    ```

-   Quanto o valor médio varia conforme a região?


```{r include=FALSE}

media_uf <- tabela_microdados_vinculos %>% 
  group_by(sigla_uf) %>% 
  summarise(media = round(mean(valor_remuneracao_media), 2)) %>% 
  arrange(desc(media))

```

```{r}
knitr::kable(head(media_uf))

```
```{r fig.width = 11, fig.height = 11}

media_uf %>% 
  mutate(sigla_uf = fct_reorder(sigla_uf, media)) %>% 
  arrange(desc(sigla_uf)) %>% 
  ggplot() +
  geom_col(aes(x = media, y = sigla_uf, fill = sigla_uf), show.legend = FALSE) +
  geom_text(aes(x = (media*0.8), y = sigla_uf, label = media)) +
  theme_minimal()+
  labs(x = "\nSalário médio (R$)\n", y = "\nUnidade da Federação\n", title = "Salário médio de um cientista de dados por estado")
```
 

-   Quanto o valor médio varia em função dos seguintes componentes:

    -   Gênero
    
```{r}

media_genero <- tabela_microdados_vinculos %>%
  mutate(sexo = ifelse(sexo == 1, "Masculino", "Feminino")) %>% 
  group_by(sexo) %>% 
  summarise(media = round(mean(valor_remuneracao_media),2))


```
    
```{r}

media_genero %>%
  ggplot()+
  geom_col(aes(x = sexo, y = media, fill = sexo), show.legend = FALSE) +
  geom_text(aes(x = sexo, y = media*0.85, fontface = 'bold', label = media)) +
  theme_minimal()+
  labs(x = "\nGênero", y = "\nSalário Médio(R$)\n", title = "Salário médio de um cientista de dados por gênero")
  

```


    -   Raça/cor

```{r}
media_raca <- tabela_microdados_vinculos %>% 
   mutate(raca_cor= case_when(
                              raca_cor == 1 ~ "Indígena",
                              raca_cor == 2 ~ "Branca",
                              raca_cor == 4 ~ "Preta",
                              raca_cor == 6 ~ "Amarela",
                              raca_cor == 8 ~ "Parda",
                              raca_cor == 9 ~ "Não identificado",
                              raca_cor == -1 ~ "Ignorado"
                              )) %>% 
  mutate(sexo = ifelse(sexo == 1, "Masculino", "Feminino")) %>% 
  group_by(raca_cor) %>% 
  summarise(media = round(mean(valor_remuneracao_media), 2))

knitr::kable(media_raca)
```

```{r}
media_raca %>% 
  mutate(raca_cor = fct_reorder(raca_cor, media)) %>% 
  arrange(raca_cor, desc = FALSE) %>% 
  ggplot()+
  geom_col(aes( y = raca_cor, x = media, fill = raca_cor), show.legend = FALSE)+
  geom_text(aes(x = media*0.8, y = raca_cor, label = media))+
  theme_minimal()+
  labs(y = "\nRaça/Cor", x = "\nSalário médio (R$)", title = "Salário médio de um cientista de dados por Raça/Cor")

```

    -   Idade


